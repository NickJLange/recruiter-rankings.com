<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Web" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%# Canonical and meta (fallbacks) %>
    <link rel="canonical" href="<%= canonical_url %>">
    <meta name="description" content="<%= content_for?(:meta_description) ? yield(:meta_description) : 'De‑identified recruiter quality signals with right‑of‑reply.' %>">
    <meta property="og:site_name" content="Recruiter Rankings">
    <meta property="og:title" content="<%= content_for?(:title) ? yield(:title) : 'Recruiter Rankings' %>">
    <meta property="og:description" content="<%= content_for?(:meta_description) ? yield(:meta_description) : 'De‑identified recruiter quality signals with right‑of‑reply.' %>">
    <meta property="og:type" content="website">
    <meta property="og:url" content="<%= canonical_url %>">
    <meta name="twitter:card" content="summary">

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">
    <link rel="shortcut icon" href="/favicon.ico">

    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag :app %>
    <%# Include the Jekyll site stylesheet to unify theme %>
    <link rel="stylesheet" href="/assets/style.css" />
    <script>
      (function(){
        try{
          var stored = localStorage.getItem('theme');
          var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          var theme = stored || (prefersDark ? 'dark' : 'light');
          document.documentElement.setAttribute('data-theme', theme);
        }catch(e){ document.documentElement.setAttribute('data-theme','dark'); }
      })();
    </script>
  </head>

  <body>
    <header class="site-header">
      <nav class="container nav">
        <a class="brand" href="/">Recruiter Rankings</a>
        <div class="nav-links">
          <a href="/search"><%= t('nav.search', default: 'Search') %></a>
          <a href="/companies?type=recruiting">Recruiting Companies</a>
          <a href="/companies?type=hiring">Hiring Companies</a>
          <a href="/about"><%= t('nav.about') %></a>
          <a href="/admin">Moderator Dashboard</a>
          <a href="/identity_verifications/new">Register / Verify</a>
          <a href="/reviews/new" class="nav-btn">Share a Review</a>
          
          <% if current_user %>
            <span style="margin-left:10px; font-size:0.9em; color:#fff;">
              Logged in as <%= current_user.role.humanize %>
              <% if current_user.paid? %> (Paid)<% end %>
              <% if Rails.env.development? %>
                [<%= link_to "Logout", logout_path, method: :delete, style: "color:#fff; text-decoration:underline;" %>]
              <% end %>
            </span>
          <% elsif Rails.env.development? || Rails.env.test? %>
             <a href="<%= login_path %>" style="color:#aaf;">Dev Login</a>
          <% end %>
        </div>
      </nav>
      <div class="container" style="padding-bottom:8px;">
        <small class="muted"><%= t('nav.top_companies', default: 'Top companies') %>:</small>
        <ul id="top-companies-nav" style="display:inline-flex; gap:10px; list-style:none; margin:0 0 0 8px; padding:0;">
          <% (@top_companies || []).each do |company| %>
            <li><%= link_to company.name, company_path(company) %></li>
          <% end %>
        </ul>
      </div>
    </header>

    <main class="container">
      <% flash.each do |type, msg| %>
        <div class="alert alert-<%= type == 'notice' ? 'info' : 'danger' %>">
          <%= msg %>
        </div>
      <% end %>
      <%= yield %>
    </main>

    <footer class="site-footer container">
      <p>© <%= Time.current.year %> Recruiter Rankings. All rights reserved.</p>
    </footer>
    <script src="/assets/theme.js"></script>

  </body>
</html>
